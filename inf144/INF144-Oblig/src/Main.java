import java.util.ArrayList;

/**
 * Created by sifu on 22/03/18.
 */
public class Main {
    private static String source = "Askeladden som stjal sølvendene til trollet Det var en gang en fattigmann som hadde tre sønner Da han døde skulle de to eldste sønnene dra ut i verden og friste lykken men den yngste ville de slett ikke ha med seg Du da sa de du duger ikke til annet enn å sitte og grave i oska du Så får jeg gå alene jeg sa Askeladden Det to gikk og kom til kongsgården der fikk de tjeneste den ene hos stallmesteren og den andre hos hagemesteren Askeladden gikk også avsted og tok med seg et stort knatraug som var det eneste de hadde etter foreldrene men som de andre to ikke brydde seg noe om det var tungt åbære men han ville da ikke la det stå igjen Da han hadde gått en stund kom han til kongsgården han også og ba om tjeneste De svarte at de hadde ikke bruk for ham men han ba så inderlig vakkert og så skulle han da til sist få lov å være i kjøkkenet og bære ved og vann til kokkejenta Han var flittig og flink og det vare ikke lenge før alle holdt av ham men de andre to var late og derfor fikk de hugg og liten lønn og så ble de avindsyke på Askeladden da de så det gikk likere med ham Midt imot kongsgården på den andre siden av et stort vann bodde et troll og det hadde syv sølvender som lå og svømte ute på vannet så de kunne se dem fra kongsgården Dem hadde kongen ofte ønsket seg og så sa de to brødrene til stallmesteren Dersom bror vår ville har han sagt seg god for å skaffe kongen de syv sølvendene En kan nok vite det ikke var lenge før stallmesteren sa det til kongen Kongen ropte da Askeladden inn til seg og sa Brødrene dine forteller at du kan skaffe meg sølvendene og nå skal du gjøre det Det har jeg hverken tenkt eller sagt sa gutten Men kongen ble ved sitt Du har sagt det og du skal sa han Ja ja sa gutten når det ikke kan være annet så la meg få et kvartel rug og et kvartel hvete så får jeg vel prøve Det fikk han og la i knatrauget han hadde tatt med hjemmefra og rodde over med det Da han kom på den andre siden ga han seg til å gå på strandkanten og strø og strø og til slutt fikk han lokket endene ut i trauget og rodde så tilbake det forteste han kunne Da han var midt utpå kom trollet og fikk se ham Har du reist av med de syv sølvendene mine du ropte det Jaa sa gutten Kommer du igjen spurte trollet Kan vel hende sa gutten Da han kom tilbake til kongen med de syv sølvendene ble han enda bedre likt i kongsgården og selve kongen sa det var godt gjort men brødrene hans ble enda mer harme og misunnelige på ham og så fant de på å si til stallmesteren at nå hadde han sagt seg god for å skaffe kongen sengeteppet til trollet med en sølvrute og en gullrute og en sølvrute og en gullrute i når han bare ville og stallmesteren var ikke sen denne gangen heller med å fortelle det til kongen Kongen sa da til gutten at brødrene hans hadde fortalt han sa seg god for å skaffe trollets sengeteppe med sølv og gullrutene i og nå skulle han gjøre det eller også skulle han miste livet Askeladden svarte at det hadde han hverken tenkt eller sagt men det hjalp ikke og så ba han om tre dager å områ seg i Da de var omme rodde han over i knatrauget og gikk fram og tilbake og lurte Endelig så han at de i berget hengte ut sengeteppet for å lufte det og da de var kommet vel inn i fjellet igjen knep Askeladden det og rodde tilbake det forteste han kunne Da han var midt utpå kom trollet ut og fikk se ham Er det du som har tatt de syv sølvendene mine ropte trollet Jaa sa gutten Har du nå tatt sengeteppet mitt med en sølvrute og en gullrute og en sølvrute og en gullrute i også Jaa sa gutten Kommer du igjen oftere du Kan nok hende det sa gutten Da han kom tilbake med gull og sølvteppet holdt alle enda mer av ham enn før og han ble tjener hos kongen selv For det ble de andre to enda mer harme og for å hevne seg fant de på å si til stallmesteren Nå har bror vår sagt seg god for å skaffe kongen den gullharpen som trollet har og som er slik at alle blir glade når de bare får høre den om de er aldri så sørgmodige Ja stallmesteren han fortalte det straks til kongen igjen og han sa til gutten Har du sagt det så skal du gjøre det kan du så skal du få prinsessen og halve riket men kan du ikke skal du miste livet Jeg har hverken tenkt eller sagt det svarte Askeladden men det er vel ingen annen råd jeg får vel friste Men seks dager vil jeg ha å områ meg i Ja det skulle han få men da de var omme måtte han i veien Han tok en spiker en bjørkepinne og en lysstubb i lommen og rodde over og gikk utenfor der fram og tilbake og smatt Om en stund kom trollet ut og fikk se ham Er det du som har tatt de syv sølvendene mine ropte trollet Jaa sa gutten Det er du som har tatt sengeteppet mitt med sølv og gullrutene også da spurte trollet Jaa sa gutten Så grep trollet ham og tok ham med seg inn i berget Nå datter mi sa han nå har jeg fått tak i ham som har tatt sølvendene mine og sengeteppet mitt med sølv og gullrutene i sett ham nå på gjøstien så skal vi slakte ham og be til oss skyldfolkene våre Det var hun straks villig til og satte ham på gjøstien og der sto han i åtte dager og fikk alt det beste han ville ønske seg både av mat og drikke og det så mye han ville ha Da de åtte dagene var omme sa trollet til datteren at hun fikk gå ned og skjære ham i veslefingeren så de kunne få se om han var feit Hun ned til gjøstien Kom med veslefingeren din sa hun men Askeladden stakk ut spikeren og den skar hun i Å nei han er hard som jern ennå sa trolldatteren da hun kom til far sin igjen ennå er han ikke takendes Åtte dager etter gikk det like ens bare at Askeladden nå satte fram bjørkepinnen Litt likere er han sa hun da hun kom inn igjen til trollet men ennå ble han hard å tygge som tre Men om åtte dager sa trollet igjen at datteren fikk gå ned og se om han ikke nå var feit Kom med veslefingeren din sa trolldatteren til han i gjøstien denne gangen stakk Askeladden fram lysstubben Nå er han så tålelig sa hun Ja så sa trollet så reiser jeg bort da og ber til gjestebuds imens får du slakte ham og steike det halve og koke det halve Da trollet var vel av gårde ga datteren seg til å bryne en stor lang kniv Skal du ha den og slakte meg med spurte gutten Ja du sa trolldatteren Men den er ikke kvass sa gutten jeg kommer nok til å bryne den jeg så du kan få livet av meg mer lettvint Ja hun lot ham få kniven og han til å slipe og bryne La meg prøve den på hårfletta di sa gutten jeg tror den skal være bra nå Det fikk han lov til men i det samme han grep i hårfletta bøyde han hodet bakover og skar det av trolldatteren og kokte så det halve og stekte det halve og satte det på bordet Så tok han på seg klærne hennes og satte seg borti kroken Da trollet kom hjem med gjestebudsfolkene ba han datteren for han trodde det var henne som satt der han at hun også skulle komme og få seg mat Nei svarte gutten jeg vil ikke ha mat jeg er så stur og lei av meg Å du vet vel råd for det sa trollet ta gullharpen og spill på Ja hvor er nå den henne da spurte Askeladden igjen Du vet vel det du du har jo sist brukt den den henger jo der over døra sa trollet Gutten lot seg ikke si to ganger han tok den og gikk ut og inn og spilte men rett som det var så skjøv han knatrauget ut og rodde avsted så det fosset om trauget Om en stund syntes trollet at datteren ble for lenge ute og gikk etter for å se hva som feilte henne så fikk han øye på gutten i trauget langt langt ute på vannet Er det du som har tatt de syv sølvendene mine ropte trollet Ja sa Askeladden Det er du som har tatt teppet mitt med en sølvrute og en gullrute i også da Ja sa Askeladden Har du nå tatt gullharpen min med skrek trollet Ja jeg har nok det sa gutten Har jeg ikke ett deg opp likevel da Nei det var datter di du åt svarte gutten Da trollet hørte det ble han så harm at han sprakk og så rodde Askeladden tilbake og tok med seg en hel haug gull og sølv så mye som trauget kunne bære Da han kom til kongsgården med gullharpen fikk han kongsdatteren og halve riket slik som kongen hadde lovt ham Men brødrene sine gjorde han vel imot for han trodde de bare hadde villet hans beste med det de hadde sagt";
    private static String source1 = "A_DEAD_DAD_CEDED_A_BAD_BABE_A_BEADED_ABACA_BEADECB";
    private static String source2 = "This is dubious";

    public static void main(String[] args) {
//        System.out.println("Working. Please wait...");
//        Markov markov = new Markov(source);
//        String zeroOrderText = markov.getRandomTextByOrder(0);
//        String firstOrderText = markov.getRandomTextByOrder(1);
//        String secondOrderText = markov.getRandomTextByOrder(2);
//        String thirdOrderText = markov.getRandomTextByOrder(3);

        //System.out.println(zeroOrderText);
        //System.out.println(firstOrderText);
        //System.out.println(secondOrderText);
//        System.out.println(thirdOrderText);

//        LZW lzwSource = new LZW(source);
//        String lzwEncodedSource = lzwSource.getEncodedString();
//        String lzwEncodedSourceBinary = lzwSource.getEncodedBinaryText();
//        System.out.println("COMPARING ORIGINAL TO LZW COMPRESSION");
//        System.out.println("The length of the source is " + source.length()*7 + " bits");
//        System.out.println("The length of LZW-compressed text is " + lzwEncodedSourceBinary.length());
//        System.out.println("COMPRESSION RATE=" + getCompressionRate(source, lzwEncodedSource) + "%\n");
//            LZW lzwZero = new LZW(zeroOrderText);
//            LZW lzwOne = new LZW(firstOrderText);
//            LZW lzwTwo = new LZW(secondOrderText);
//            LZW lzwThree = new LZW(thirdOrderText);

//        Huffman huffman = new Huffman(lzwEncodedSource);
//        String huffmanText = huffman.getBinaryEncoded();
//        System.out.println("COMPARING LZW TO LZW /W HUFFMAN");
//        System.out.println("The length of LZW-compressed text is " + lzwEncodedSourceBinary.length());
//        System.out.println("The length of huffman-augmented LZW is " + huffmanText.length());
//        System.out.println("COMPRESSION RATE=" + getCompressionRate(lzwEncodedSourceBinary, huffmanText) + "%\n");
        computeAverageCompression(100);
    }

    public static double getCompressionRate(String uncompressed, String compressed) {
        return (100 - ((double) compressed.length() / uncompressed.length()) * 100);
    }

    public static void computeAverageCompression(int loops) {
        ArrayList<Double> lzwAverages = new ArrayList<>();
        ArrayList<Double> huffmanAverages = new ArrayList<>();

        double lzwAvg = 0.0;
        double huffmanAvg = 0.0;

        for (int i=0; i < loops; i++) {
            System.out.println(i);
            Markov m = new Markov(source);
            LZW l0 = new LZW(m.getRandomTextByOrder(0));
            LZW l1 = new LZW(m.getRandomTextByOrder(1));
            LZW l2 = new LZW(m.getRandomTextByOrder(2));
            LZW l3 = new LZW(m.getRandomTextByOrder(3));

            Huffman h0 = new Huffman(l0.getEncodedString());
            Huffman h1 = new Huffman(l1.getEncodedString());
            Huffman h2 = new Huffman(l2.getEncodedString());
            Huffman h3 = new Huffman(l3.getEncodedString());

            double comp0 = getCompressionRate(source, l0.getEncodedString());
            double comp1 = getCompressionRate(source, l1.getEncodedString());
            double comp2 = getCompressionRate(source, l2.getEncodedString());
            double comp3 = getCompressionRate(source, l3.getEncodedString());

            lzwAverages.add((comp0 + comp1 + comp2 + comp3)/4);

            double hComp0 = getCompressionRate(l0.getEncodedBinaryText(), h0.getBinaryEncoded());
            double hComp1 = getCompressionRate(l1.getEncodedBinaryText(), h1.getBinaryEncoded());
            double hComp2 = getCompressionRate(l2.getEncodedBinaryText(), h2.getBinaryEncoded());
            double hComp3 = getCompressionRate(l3.getEncodedBinaryText(), h3.getBinaryEncoded());

            huffmanAverages.add((hComp0 + hComp1 + hComp2 + hComp3)/4);
        }

        for (double d : lzwAverages) {
            lzwAvg = lzwAvg + d;
        }
        lzwAvg = lzwAvg/lzwAverages.size();

        for (double d : huffmanAverages) {
            huffmanAvg = huffmanAvg + d;
        }

        huffmanAvg = huffmanAvg/huffmanAverages.size();
        System.out.println("THE AVERAGE COMPRESSION RATE WITH ONLY LZW IS " +lzwAvg);
        System.out.println("THE AVERAGE COMPRESSION RATE WITH HUFFMAN IS " +huffmanAvg);
    }

}
